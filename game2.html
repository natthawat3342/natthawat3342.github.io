<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เกมยิงซอมบี้ขั้นสูง</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a0e0e, #2d1b1b);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .game-container {
            width: 1000px;
            height: 700px;
            background: linear-gradient(to bottom, #3a3a3a, #1a1a1a);
            position: relative;
            border: 3px solid #8B4513;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(139, 69, 19, 0.8);
        }
        
        .name-tag {
            position: absolute;
            top: 15px;
            right: 20px;
            color: #FFD700;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            padding: 8px 15px;
            border-radius: 8px;
            border: 2px solid #FFD700;
        }
        
        .ui-panel {
            position: absolute;
            top: 15px;
            left: 20px;
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #555;
        }
        
        .weapon-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: #fff;
            font-size: 14px;
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #555;
        }
        
        .character-select {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: #fff;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            z-index: 2000;
            border: 2px solid #FFD700;
        }
        
        .character-option {
            display: inline-block;
            margin: 10px;
            padding: 15px;
            background: #333;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid #555;
            transition: all 0.3s;
        }
        
        .character-option:hover {
            background: #555;
            border-color: #FFD700;
        }
        
        .player {
            width: 30px;
            height: 30px;
            position: absolute;
            border-radius: 3px;
            box-shadow: 0 0 15px rgba(0,255,0,0.7);
            transition: all 0.1s;
        }
        
        .zombie {
            position: absolute;
            border-radius: 3px;
            transition: all 0.1s;
        }
        
        .zombie-normal {
            width: 25px;
            height: 25px;
            background: #ff4444;
            box-shadow: 0 0 8px rgba(255,68,68,0.5);
        }
        
        .zombie-fast {
            width: 20px;
            height: 20px;
            background: #ff8800;
            box-shadow: 0 0 10px rgba(255,136,0,0.7);
        }
        
        .zombie-boss {
            width: 50px;
            height: 50px;
            background: #880000;
            box-shadow: 0 0 20px rgba(136,0,0,0.9);
            border: 2px solid #ff0000;
        }
        
        .bullet {
            width: 6px;
            height: 6px;
            background: #ffff00;
            position: absolute;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(255,255,0,0.9);
        }
        
        .health-bar {
            position: absolute;
            width: 100%;
            height: 4px;
            background: #333;
            top: -8px;
            border-radius: 2px;
        }
        
        .health-fill {
            height: 100%;
            background: #00ff00;
            border-radius: 2px;
            transition: width 0.3s;
        }
        
        .game-over, .victory {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 36px;
            font-weight: bold;
            text-align: center;
            z-index: 2000;
            background: rgba(0,0,0,0.9);
            padding: 30px;
            border-radius: 15px;
            display: none;
            border: 3px solid #ff0000;
        }
        
        .victory {
            border-color: #00ff00;
            color: #00ff00;
        }
        
        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            color: #fff;
            font-size: 12px;
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            text-align: right;
        }
        
        .mission {
            position: absolute;
            top: 80px;
            right: 20px;
            color: #FFD700;
            font-size: 14px;
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #FFD700;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="name-tag">ณัฐวัชร พิมพ์คำ</div>
        
        <div class="character-select" id="characterSelect">
            <h2>เลือกตัวละคร</h2>
            <div class="character-option" onclick="selectCharacter('assault')">
                <h3>นักรบจู่โจม</h3>
                <p>ความเสียหาย +50%<br>ความเร็วปืน +30%</p>
            </div>
            <div class="character-option" onclick="selectCharacter('medic')">
                <h3>แพทย์สนาม</h3>
                <p>ฟื้นฟูพลังชีวิต<br>ต้านทานความเสียหาย +25%</p>
            </div>
            <div class="character-option" onclick="selectCharacter('engineer')">
                <h3>วิศวกร</h3>
                <p>กระสุนไม่จำกัด<br>อาวุธหลากหลาย</p>
            </div>
        </div>
        
        <div class="ui-panel">
            <div>คะแนน: <span id="score">0</span></div>
            <div>ชีวิต: <span id="lives">100</span></div>
            <div>กระสุน: <span id="ammo">30</span></div>
            <div>เวฟ: <span id="wave">1</span></div>
            <div>ซอมบี้เหลือ: <span id="zombiesLeft">5</span></div>
        </div>
        
        <div class="mission" id="mission">
            ภารกิจ: กำจัดซอมบี้ในเวฟนี้
        </div>
        
        <div class="weapon-panel">
            <div>อาวุธ: <span id="currentWeapon">ปืนพก</span></div>
            <div>1-ปืนพก | 2-ปืนลูกซอง | 3-ไรเฟิล | R-เติมกระสุน</div>
        </div>
        
        <div class="player" id="player"></div>
        
        <div class="controls">
            WASD = เคลื่อนที่<br>
            เมาส์ = เล็งและยิง<br>
            1,2,3 = เปลี่ยนอาวุธ<br>
            R = เติมกระสุน
        </div>
        
        <div class="game-over" id="gameOver">
            <div>GAME OVER</div>
            <div style="font-size: 18px; margin-top: 15px;">กด SPACE เพื่อเริ่มใหม่</div>
        </div>
        
        <div class="victory" id="victory">
            <div>ชนะแล้ว!</div>
            <div style="font-size: 18px; margin-top: 15px;">กด SPACE เพื่อเวฟถัดไป</div>
        </div>
    </div>

    <script>
        let game = {
            player: { 
                x: 500, y: 350, speed: 4, health: 100, maxHealth: 100,
                character: null, damageBonus: 0, defenseBonus: 0
            },
            zombies: [],
            bullets: [],
            score: 0,
            wave: 1,
            zombiesInWave: 5,
            zombiesKilled: 0,
            gameRunning: false,
            keys: {},
            mouseX: 0,
            mouseY: 0,
            currentWeapon: 0,
            weapons: [
                { name: 'ปืนพก', damage: 25, ammo: 30, maxAmmo: 30, fireRate: 300, lastFire: 0 },
                { name: 'ปืนลูกซอง', damage: 60, ammo: 8, maxAmmo: 8, fireRate: 800, lastFire: 0 },
                { name: 'ไรเฟิล', damage: 45, ammo: 20, maxAmmo: 20, fireRate: 200, lastFire: 0 }
            ]
        };

        const gameContainer = document.querySelector('.game-container');
        const player = document.getElementById('player');
        const elements = {
            score: document.getElementById('score'),
            lives: document.getElementById('lives'),
            ammo: document.getElementById('ammo'),
            wave: document.getElementById('wave'),
            zombiesLeft: document.getElementById('zombiesLeft'),
            mission: document.getElementById('mission'),
            currentWeapon: document.getElementById('currentWeapon'),
            gameOver: document.getElementById('gameOver'),
            victory: document.getElementById('victory'),
            characterSelect: document.getElementById('characterSelect')
        };

        // เลือกตัวละคร
        function selectCharacter(type) {
            game.player.character = type;
            
            switch(type) {
                case 'assault':
                    player.style.background = '#ff4400';
                    game.player.damageBonus = 0.5;
                    game.weapons.forEach(w => w.fireRate *= 0.7);
                    break;
                case 'medic':
                    player.style.background = '#44ff44';
                    game.player.defenseBonus = 0.25;
                    break;
                case 'engineer':
                    player.style.background = '#4444ff';
                    game.weapons.forEach(w => w.maxAmmo *= 2);
                    game.weapons.forEach(w => w.ammo = w.maxAmmo);
                    break;
            }
            
            elements.characterSelect.style.display = 'none';
            game.gameRunning = true;
            startWave();
        }

        // การจัดการเมาส์
        gameContainer.addEventListener('mousemove', (e) => {
            const rect = gameContainer.getBoundingClientRect();
            game.mouseX = e.clientX - rect.left;
            game.mouseY = e.clientY - rect.top;
        });

        gameContainer.addEventListener('click', (e) => {
            if (game.gameRunning) {
                shoot();
            }
        });

        // การจัดการแป้นพิมพ์
        document.addEventListener('keydown', (e) => {
            game.keys[e.key.toLowerCase()] = true;
            
            if (e.key === ' ') {
                e.preventDefault();
                if (!game.gameRunning && elements.gameOver.style.display === 'block') {
                    restartGame();
                } else if (!game.gameRunning && elements.victory.style.display === 'block') {
                    nextWave();
                }
            }
            
            if (e.key.toLowerCase() === 'r') {
                reload();
            }
            
            // เปลี่ยนอาวุธ
            if (['1', '2', '3'].includes(e.key)) {
                game.currentWeapon = parseInt(e.key) - 1;
                elements.currentWeapon.textContent = game.weapons[game.currentWeapon].name;
            }
        });

        document.addEventListener('keyup', (e) => {
            game.keys[e.key.toLowerCase()] = false;
        });

        function updatePlayer() {
            if (!game.gameRunning) return;
            
            // การเคลื่อนที่
            if (game.keys['a'] || game.keys['arrowleft']) {
                game.player.x = Math.max(15, game.player.x - game.player.speed);
            }
            if (game.keys['d'] || game.keys['arrowright']) {
                game.player.x = Math.min(970, game.player.x + game.player.speed);
            }
            if (game.keys['w'] || game.keys['arrowup']) {
                game.player.y = Math.max(15, game.player.y - game.player.speed);
            }
            if (game.keys['s'] || game.keys['arrowdown']) {
                game.player.y = Math.min(670, game.player.y + game.player.speed);
            }
            
            // การหมุนตามเมาส์
            const angle = Math.atan2(game.mouseY - game.player.y, game.mouseX - game.player.x);
            player.style.transform = `rotate(${angle}rad)`;
            
            // อัพเดตตำแหน่ง
            player.style.left = game.player.x + 'px';
            player.style.top = game.player.y + 'px';
            
            // ฟื้นฟูพลังชีวิต (แพทย์)
            if (game.player.character === 'medic' && game.player.health < game.player.maxHealth) {
                game.player.health = Math.min(game.player.maxHealth, game.player.health + 0.1);
            }
        }

        function shoot() {
            const weapon = game.weapons[game.currentWeapon];
            const now = Date.now();
            
            if (weapon.ammo <= 0 || now - weapon.lastFire < weapon.fireRate) return;
            
            weapon.ammo--;
            weapon.lastFire = now;
            
            const angle = Math.atan2(game.mouseY - game.player.y, game.mouseX - game.player.x);
            
            // ปืนลูกซองยิงหลายนัด
            const shots = weapon.name === 'ปืนลูกซอง' ? 5 : 1;
            
            for (let i = 0; i < shots; i++) {
                const spread = weapon.name === 'ปืนลูกซอง' ? (Math.random() - 0.5) * 0.5 : 0;
                const bulletAngle = angle + spread;
                
                game.bullets.push({
                    x: game.player.x + 15,
                    y: game.player.y + 15,
                    vx: Math.cos(bulletAngle) * 10,
                    vy: Math.sin(bulletAngle) * 10,
                    damage: weapon.damage * (1 + game.player.damageBonus),
                    element: createBullet()
                });
            }
        }

        function createBullet() {
            const bullet = document.createElement('div');
            bullet.className = 'bullet';
            gameContainer.appendChild(bullet);
            return bullet;
        }

        function reload() {
            const weapon = game.weapons[game.currentWeapon];
            weapon.ammo = weapon.maxAmmo;
        }

        function startWave() {
            game.zombiesInWave = 5 + (game.wave - 1) * 3;
            game.zombiesKilled = 0;
            elements.mission.textContent = `ภารกิจ: กำจัดซอมบี้ ${game.zombiesInWave} ตัว`;
            
            // สร้างซอมบี้ตามเวฟ
            for (let i = 0; i < game.zombiesInWave; i++) {
                setTimeout(() => spawnZombie(), i * 1000 + Math.random() * 2000);
            }
        }

        function spawnZombie() {
            if (!game.gameRunning) return;
            
            let zombieType = 'normal';
            let health = 50;
            let speed = 1;
            let damage = 20;
            
            // กำหนดประเภทซอมบี้ตามเวฟ
            const rand = Math.random();
            if (game.wave >= 3 && rand < 0.3) {
                zombieType = 'fast';
                health = 30;
                speed = 2.5;
                damage = 15;
            } else if (game.wave >= 5 && rand < 0.1) {
                zombieType = 'boss';
                health = 200;
                speed = 0.8;
                damage = 40;
            }
            
            const side = Math.floor(Math.random() * 4);
            let x, y;
            
            switch(side) {
                case 0: x = -30; y = Math.random() * 700; break; // ซ้าย
                case 1: x = 1030; y = Math.random() * 700; break; // ขวา
                case 2: x = Math.random() * 1000; y = -30; break; // บน
                case 3: x = Math.random() * 1000; y = 730; break; // ล่าง
            }
            
            const zombie = {
                x, y, speed, health, maxHealth: health, damage, type: zombieType,
                element: document.createElement('div')
            };
            
            zombie.element.className = `zombie zombie-${zombieType}`;
            zombie.element.style.left = x + 'px';
            zombie.element.style.top = y + 'px';
            
            // เพิ่มแถบพลังชีวิต
            const healthBar = document.createElement('div');
            healthBar.className = 'health-bar';
            const healthFill = document.createElement('div');
            healthFill.className = 'health-fill';
            healthBar.appendChild(healthFill);
            zombie.element.appendChild(healthBar);
            zombie.healthFill = healthFill;
            
            gameContainer.appendChild(zombie.element);
            game.zombies.push(zombie);
        }

        function updateZombies() {
            game.zombies.forEach((zombie, index) => {
                // เคลื่อนที่เข้าหาผู้เล่น
                const dx = game.player.x - zombie.x;
                const dy = game.player.y - zombie.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 0) {
                    zombie.x += (dx / distance) * zombie.speed;
                    zombie.y += (dy / distance) * zombie.speed;
                }
                
                zombie.element.style.left = zombie.x + 'px';
                zombie.element.style.top = zombie.y + 'px';
                
                // อัพเดตแถบพลังชีวิต
                const healthPercent = (zombie.health / zombie.maxHealth) * 100;
                zombie.healthFill.style.width = healthPercent + '%';
                
                // ตรวจสอบการชนกับผู้เล่น
                if (distance < 35) {
                    const actualDamage = zombie.damage * (1 - game.player.defenseBonus);
                    game.player.health -= actualDamage;
                    zombie.element.remove();
                    game.zombies.splice(index, 1);
                    
                    if (game.player.health <= 0) {
                        gameOver();
                    }
                }
            });
        }

        function updateBullets() {
            game.bullets.forEach((bullet, bulletIndex) => {
                bullet.x += bullet.vx;
                bullet.y += bullet.vy;
                
                bullet.element.style.left = bullet.x + 'px';
                bullet.element.style.top = bullet.y + 'px';
                
                // ลบกระสุนที่ออกจากหน้าจอ
                if (bullet.x < 0 || bullet.x > 1000 || bullet.y < 0 || bullet.y > 700) {
                    bullet.element.remove();
                    game.bullets.splice(bulletIndex, 1);
                    return;
                }
                
                // ตรวจสอบการชนกับซอมบี้
                game.zombies.forEach((zombie, zombieIndex) => {
                    const dx = bullet.x - zombie.x;
                    const dy = bullet.y - zombie.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 25) {
                        zombie.health -= bullet.damage;
                        bullet.element.remove();
                        game.bullets.splice(bulletIndex, 1);
                        
                        if (zombie.health <= 0) {
                            zombie.element.remove();
                            game.zombies.splice(zombieIndex, 1);
                            game.zombiesKilled++;
                            game.score += zombie.type === 'boss' ? 100 : zombie.type === 'fast' ? 20 : 10;
                            
                            // ตรวจสอบว่าชนะเวฟแล้วหรือยัง
                            if (game.zombiesKilled >= game.zombiesInWave) {
                                waveComplete();
                            }
                        }
                    }
                });
            });
        }

        function updateUI() {
            elements.score.textContent = game.score;
            elements.lives.textContent = Math.max(0, Math.floor(game.player.health));
            elements.ammo.textContent = game.weapons[game.currentWeapon].ammo;
            elements.wave.textContent = game.wave;
            elements.zombiesLeft.textContent = Math.max(0, game.zombiesInWave - game.zombiesKilled);
        }

        function waveComplete() {
            game.gameRunning = false;
            elements.victory.style.display = 'block';
        }

        function nextWave() {
            game.wave++;
            game.gameRunning = true;
            elements.victory.style.display = 'none';
            
            // เติมกระสุนและฟื้นฟูพลังชีวิตบางส่วน
            game.weapons.forEach(w => w.ammo = w.maxAmmo);
            game.player.health = Math.min(game.player.maxHealth, game.player.health + 25);
            
            startWave();
        }

        function gameOver() {
            game.gameRunning = false;
            elements.gameOver.style.display = 'block';
        }

        function restartGame() {
            // รีเซ็ตเกม
            game = {
                player: { 
                    x: 500, y: 350, speed: 4, health: 100, maxHealth: 100,
                    character: null, damageBonus: 0, defenseBonus: 0
                },
                zombies: [],
                bullets: [],
                score: 0,
                wave: 1,
                zombiesInWave: 5,
                zombiesKilled: 0,
                gameRunning: false,
                keys: {},
                mouseX: 0,
                mouseY: 0,
                currentWeapon: 0,
                weapons: [
                    { name: 'ปืนพก', damage: 25, ammo: 30, maxAmmo: 30, fireRate: 300, lastFire: 0 },
                    { name: 'ปืนลูกซอง', damage: 60, ammo: 8, maxAmmo: 8, fireRate: 800, lastFire: 0 },
                    { name: 'ไรเฟิล', damage: 45, ammo: 20, maxAmmo: 20, fireRate: 200, lastFire: 0 }
                ]
            };
            
            // ลบองค์ประกอบทั้งหมด
            document.querySelectorAll('.zombie, .bullet').forEach(el => el.remove());
            elements.gameOver.style.display = 'none';
            elements.victory.style.display = 'none';
            elements.characterSelect.style.display = 'block';
            
            // รีเซ็ตตำแหน่งผู้เล่น
            player.style.left = '500px';
            player.style.top = '350px';
            player.style.background = '#00ff00';
            player.style.transform = 'rotate(0rad)';
        }

        // ลูปเกมหลัก
        function gameLoop() {
            if (game.gameRunning) {
                updatePlayer();
                updateZombies();
                updateBullets();
                updateUI();
            }
            requestAnimationFrame(gameLoop);
        }

        // เริ่มต้นเกม
        gameLoop();
    </script>
</body>
</html>
